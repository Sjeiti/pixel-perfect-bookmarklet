'use strict';(function(){function a(a){a.stopPropagation(),a.preventDefault(),y.classList.add('dropping')}function b(b){a(b),y.classList.add('dropping')}function c(b){a(b),y.classList.remove('dropping')}function d(b){a(b),Array.from(b.dataTransfer.files).forEach(l),y.classList.remove('dropping')}function e(){requestAnimationFrame(function(){var a=J.contentWindow,b=a.location.href,c=a.document.title;$!==b&&h(),window.history.pushState({},c,b),$=b})}function f(){var a=L(X)||L(K);return a?JSON.parse(a):[]}function g(){return Y&&Y.slice(0).pop()||{}}function h(){var a=Z;X=J&&J.contentWindow.location.pathname||location.pathname,Y=f();var b=!1;Y.forEach(function(c){c.data===a.data&&(b=!0)}),b||(Z=g(),i(Z.data))}function i(a){j(a),C&&(C.style.backgroundImage='url('+a+')')}function j(a){a&&(R.src=a)}function k(a){Array.from(a.target.files).forEach(l)}function l(a){console.log('loadFile',a);var b=new FileReader;Z={name:a.name,lastModified:a.lastModified},b.addEventListener('load',m),b.readAsDataURL(a)}function m(a){var b=a.target,c=b.result.toString();i(c),Z&&(Z.data=c),z.value=null}function n(a){var b=a.target,c=parseInt(b.innerText,10);Y.forEach(function(a){a.naturalWidth===c&&(Z=a)}),Z&&i(Z.data)}function o(a){V.show=a.target.checked,t(),w()}function p(a){var b=a.naturalWidth,c=void 0;Y.forEach(function(a,d){a.naturalWidth===b&&(c=d)}),c!==void 0&&Y.splice(c,1),Y.includes(a)||Y.push(a),Y.sort(function(c,a){return c.naturalWidth>a.naturalWidth?1:-1})}function q(){var a='';Y.forEach(function(b){a+='<li'+(b===Z?' class="current"':'')+'>'+b.naturalWidth+'</li>'}),A.innerHTML=a}function r(){var a=!V.show;return a&&(D.checked=V.show=!0,t()),a}function s(a){V.opacity=a.target.value,0!==V.opacity&&r()||t(),w()}function t(){C.style.opacity=V.show&&V.opacity||0}function u(a,b){v(a,b.target.value)}function v(a,b){C.style[a]=b+'%',V[a]=b,r(),w()}function w(){M(U,JSON.stringify(V))}function x(){return H||Array.from(document.styleSheets).forEach(function(a){a.title===K&&(H=a)}),H}var y,z,A,B,C,D,E,F,G,H,I,J,K='pixelPerfect',L=localStorage.getItem.bind(localStorage),M=localStorage.setItem.bind(localStorage),N=document,O=N.body,P=document.getElementById(K)||document.createElement('div'),Q=2147483647,R=document.createElement('img'),S={left:37,up:38,right:39,down:40},T={show:!0,opacity:0.3,width:100,height:100},U=K+'Data',V=Object.assign(T,JSON.parse(L(U)))||T,W=location,X=W.pathname,Y=f(),Z=g(),$=location.href;h();var _='#'+K+' {\n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: '+(Q-100)+';\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n  #'+K+'.dropping {\n    box-shadow: 0 0 64px rgba(91,180,0,0.9) inset;\n    pointer-events: initial;\n  }\n  #'+K+', #'+K+' * {\n    font-family: Helvetica, Verdana, Arial, sans;\n    font-size: 12px;\n    color: $444;\n  }\n  #'+K+' .inner {\n    position: fixed;\n    left: 10px;\n    bottom: 100vh;\n    max-width: 30px;\n    max-height: 30px;\n    padding: 0;\n    background-color: rgba(91,180,0,0.8);\n    z-index: '+(Q-10)+';\n    pointer-events: auto;\n    box-shadow: 2px 4px 16px rgba(0,0,0,0.3);\n    border-radius: 50%;\n    transition:\n        left 200ms ease-out 50ms\n        ,padding 200ms ease-out 50ms\n        ,max-width 200ms ease-out 50ms\n        ,max-height 200ms ease-out 50ms\n        ,border-radius 200ms ease-out 50ms\n        ,bottom 500ms ease;\n  }\n  #'+K+' .inner:after {\n    content: \'\';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n  }\n  #'+K+' .inner.added {\n    bottom: 10px;\n  }\n  #'+K+' .inner>* {\n    position: relative;\n    z-index: '+(Q-5)+';\n    opacity: 0;\n  }\n  #'+K+' .inner:hover {\n    left: 0;\n    bottom: 0;\n    max-width: 3330px;\n    max-height: 3330px;\n    border: 0;\n    padding: 20px;\n    border-radius: 0 4px 0 0;\n  }\n  #'+K+' .inner:hover>* {\n    opacity: 1;\n  }\n  #'+K+' .file {\n    display: inline-block;\n    width: calc(100% - 40px);\n    margin-bottom: 20px;\n    padding: 8px 16px;\n    border-radius: 2px;\n    box-shadow: 1px 1px 2px rgba(0,0,0,0.2);\n    background-color: rgba(255,255,255,0.2);\n    text-align: center;\n  }\n  #'+K+' ol {\n    margin: 0 0 20px 0;\n    padding: 0;\n    list-style: none;\n  }\n  #'+K+' li {\n    display: inline-block;\n    cursor: pointer;\n  }\n  #'+K+' li.current {\n    font-weight: bold;\n  }\n  #'+K+' li:not(:first-child) {\n    padding: 0 5px;\n  }\n  #'+K+' label {\n    display: flex;\n    margin: 0 0 8px 0;\n    justify-content: space-between;\n  }\n  #'+K+' label, #'+K+' label * {\n    cursor: pointer;\n  }\n  #'+K+' label * {\n    vertical-align: middle;\n  }\n  #'+K+' label input {\n    margin-left: 10px;\n  }\n  input[type=range] {\n    width: 200px;\n  }\n  #'+K+' .image {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: '+V.width+'%;\n    height: '+V.height+'%;\n    background-image: url('+(Z.data||'')+');\n    background-repeat: no-repeat;\n    opacity: '+(V.show&&V.opacity||0)+';\n    transition: box-shadow 200ms linear;\n  }\n  #'+K+'.mousedown .image {\n    box-shadow: 0 0 32px rgba(0,0,0,0.3);\n  }\n  #'+K+' .visually-hidden {\n    position: absolute;\n    overflow: hidden;\n    clip: rect(0 0 0 0);\n    height: 1px; width: 1px;\n    margin: -1px; padding: 0; border: 0;\n  }\n  body, html {\n    width: 100%;\n    height: 100%;\n    max-height: 100%;\n    overflow: hidden;\n  }\n  iframe.'+K+' {\n    min-width: 100%;\n    min-height: 100%;\n    max-height: 100%;\n  }',aa='<div class="inner" data-html2canvas-ignore>\n      <style title="'+K+'">'+_+'</style>\n      <label class="file">\n          add image\n          <input class="visually-hidden" type="file" accept="image/gif, image/jpg, image/jpeg, image/png, image/svg, .gif, .jpg, .jpeg, .png, .svg" />\n      </label>\n      <ol></ol>\n      <label><span>show/hide</span><input type="checkbox" '+(V.show?'checked':'')+' class="show" /></label>\n      <label><span>opacity</span><input type="range" min="0" max="1" step="0.05" value="'+V.opacity+'" class="opacity" /></label>\n      <label><span>horizontal</span><input type="range" min="0" max="100" step="0.1" value="'+V.width+'" class="horizontal" /></label>\n      <label><span>vertical</span><input type="range" min="0" max="100" step="0.1" value="'+V.height+'" class="vertical" /></label>\n  </div>\n  <div class="image"></div>';P.id=K,P.innerHTML=aa,j(Z.data),O.innerHTML='<iframe src="'+location.href+'" class="'+K+'" frameborder="0"></iframe>',O.appendChild(P),O.addEventListener('keydown',function(a){var b=a.keyCode,c=a.ctrlKey,d=b===S.up,e=b===S.down,f=b===S.left,g=b===S.right,h=d||e,i=c?10:1;if(h||f||g){var j=h?'height':'width',k=h?V.height:V.width,l=h?C.offsetHeight:C.offsetWidth,m=d||f?-1:1,n=k/l*(l+m*i);v(j,n),('width'==j?F:G).value=n,a.preventDefault()}},!0),R.addEventListener('load',function(a){var b=a.currentTarget,c=b.naturalWidth,d=b.naturalHeight,e='max-width:'+c+'px;width:'+c+'px;';Z&&(Object.assign(Z,{naturalWidth:c,naturalHeight:d}),p(Z),q()),M(K,JSON.stringify(Y)),M(X,JSON.stringify(Y)),I?I.style=e:(x().addRule('html, body, #'+K+', iframe.'+K,e),I=H.rules[H.rules.length-1])}),requestAnimationFrame(function(){y=document.getElementById(K),J=O.querySelector('iframe'),z=y.querySelector('input[type=file]'),A=y.querySelector('ol'),B=y.querySelector('.inner'),C=y.querySelector('.image'),D=y.querySelector('input.show'),E=y.querySelector('input.opacity'),F=y.querySelector('input.horizontal'),G=y.querySelector('input.vertical'),B.addEventListener('mousedown',function(){P.classList.add('mousedown')}),O.addEventListener('mouseup',function(){P.classList.remove('mousedown')}),z.addEventListener('change',k),A.addEventListener('click',n),D.addEventListener('change',o),E.addEventListener('input',s),F.addEventListener('input',u.bind(null,'width')),G.addEventListener('input',u.bind(null,'height')),O.addEventListener('dragstart',b,!0),O.addEventListener('dragover',a,!0),O.addEventListener('dragend',c,!0),O.addEventListener('drop',d,!0),J.addEventListener('load',function(){var a=J.contentDocument.body;a.addEventListener('click',e,!0),a.addEventListener('keyup',e,!0),J.contentWindow.addEventListener('popstate',h,!0)}),requestAnimationFrame(function(){return B.classList.add('added')}),Array.from(document.styleSheets).forEach(function(a){a.title===K&&(H=a)})}),console.log('asdfasdf')})();
